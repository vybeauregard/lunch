var locOptions={},fields;$.fn.locatorSearch=function(e){var e=e||!1;return this.each(function(){function t(e){var t=e.value,i=$(e).parent(),a="",r=$(i).next().hasClass("criteria");switch(t){case"":$(i).nextAll("fieldset.criteria").remove(),$(i).nextAll("div.andOr").remove(),$(i).removeClass("solidBackground").prev().addClass("bottom");break;case"or":r?$(i).removeClass("solidBackground").prev().addClass("bottom").next().next().addClass("top"):(a='<fieldset class="criteria top bottom">',a+=o,a+='</fieldset><div class="andOr text-center">',a+=n,a+="</div></div>",$(i).after(a));break;case"and":case"and not":r?$(i).addClass("solidBackground").next().removeClass("top").prev().prev().removeClass("bottom"):($(i).addClass("solidBackground").prev().removeClass("bottom"),a='<fieldset class="criteria bottom solidBackground">',a+=o,a+='</fieldset><div class="andOr text-center">',a+=n,a+="</div></div>",$(i).after(a))}}function i(e){var t=e.value,i=$(t).parent();for(var a in fields)if(fields[a].name==t){var o="";for(var n in fields[a].limitType)o+='<option value="'+fields[a].limitType[n]+'">'+fields[a].limitType[n]+"</option>";if($(e).next().empty().html(o),"string"==typeof fields[a].inputType)("undefined"==typeof $(e).next().next().attr("type")||"text"!=$(e).next().next().attr("type"))&&$(e).next().next().after('<input type="text" size="20" name="SEARCH[]">').remove();else{$(e).next().next().remove();var r='<select class="wide" name="SEARCH[]">';for(var n in fields[a].inputType)r+="object"==typeof fields[a].inputType[n]?'<option value="'+fields[a].inputType[n].value+'">'+fields[a].inputType[n].display+"</option>":'<option value="'+fields[a].inputType[n]+'">'+fields[a].inputType[n]+"</option>";r+="</select>",$(e).next().after(r)}}}var a=this,o="",n='<select name="center[]"><option value=""></option><option value="and">and</option><option value="or">or</option><option value="and not">and not</option></select>';if(locOptions.initurl="locator-search.php","undefined"!=$(a).attr("action")?locOptions.submiturl=$(a).attr("action"):locOptions.submiturl="locator-search.php",locOptions.buttontext="Search",locOptions.inactivepeople=!1,"object"==typeof e)for(key in e)"initurl"==key.toLowerCase()&&(locOptions.initurl=e[key]),"submiturl"==key.toLowerCase()&&(locOptions.submiturl=e[key]),"buttontext"==key.toLowerCase()&&(locOptions.buttontext=e[key]);$.ajax({type:"post",url:locOptions.initurl,dataType:"json",data:{q:"initThis"}}).done(function(e){if("undefined"!=typeof e.error)alert("Sorry, There was an error trying to initialize the advanced search: "+e.error);else{fields=e.success,console.log(fields),o='<select name="FIELD[]">',fields.forEach(function(e){o+='<option value="'+e.name+'">'+e.name+"</option>"}),o+='</select><select name="LIMIT[]">';for(var t in fields)if(0==t)for(var i in fields[t].limitType)o+='<option value="'+fields[t].limitType[i]+'">'+fields[t].limitType[i]+"</option>";o+='</select><input type="text" size="20" name="SEARCH[]">';var r='<div class="advancedLocatorSearchBox">';r+='<div id="criteriaGroup" class="criteriaGroup"><fieldset class="criteria top bottom">',r+=o,r+='</fieldset><div class="andOr text-center">',r+=n,r+='</div></div><div class="text-center"><input type="submit" name="SUBMIT" class="btn btn-success btn-gradient" value="'+locOptions.buttontext+'"></div>',r+="</div>",$(a).html(r)}}).fail(function(e,t){alert("Sorry, There was an error trying to initialize the advanced search: "+t)}),$(a).on("change",".andOr select",function(){t(this)}),$(a).on("change",'select[name="FIELD[]"]',function(){i(this)}),$(a).submit(function(e){e.preventDefault();var t=$(this).serializeArray();console.log(locOptions.submiturl),$.ajax({type:"post",url:locOptions.submiturl,dataType:"json",data:{searchArray:t},beforeSend:function(){$("#advancedWrapper").addClass("ajax-active")}}).done(function(e){"undefined"!=typeof e.error?alert("Sorry, There was an error trying to search: "+e.error):(console.log(e.success),$("#advSearchResults").html(e.success)),$("#advancedWrapper").removeClass("ajax-active")}).fail(function(e,t){alert("Sorry, There was an error trying to search: "+t),$("#advancedWrapper").removeClass("ajax-active")})})})};